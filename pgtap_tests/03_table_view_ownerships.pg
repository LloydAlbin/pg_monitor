\connect pgmonitor_db

-- Setup Test Variables
\set test_name 'permissions'
\set test_user 'grafana'
\set test_production_database 'pgmonitor_db'
\set plan -1

-- Install pgTAP, show diagnostics, and start common tests
--\ir ../common/diagnostic.sql
\i common/diagnostics.pg

SELECT diag('Table Ownership Tests');
SELECT diag('=================================');
SELECT table_owner_is ( table_schema, table_name, 'grafana', 'Grafana owns table ' || table_schema || '.' || table_name || '.' )
FROM information_schema.tables WHERE table_type = 'BASE TABLE' AND table_schema IN ('pgmon', 'tools');

SELECT diag('View Ownership Tests');
SELECT diag('=================================');
SELECT table_owner_is ( table_schema, table_name, 'grafana', 'Grafana owns view ' || table_schema || '.' || table_name || '.' )
FROM information_schema.tables WHERE table_type = 'VIEW' AND table_schema IN ('pgmon', 'tools');
